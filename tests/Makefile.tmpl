DESCRIP_PATH = ../src

RPN_LIB=rpn/libs/15.2

include $(DESCRIP_PATH)/setup.mk

ALL_SSM = -d $(HPCS_BASE) -d $(HPCS_COMP) -d $(RPN_LIB)

%.o: %.ftn90
	. ssmuse-sh $(ALL_SSM) ;\
	s.compile -src $< -optf =$(FFLAGS) -libpath $(DESCRIP_PATH) -includes $(DESCRIP_PATH)

%.o: %.c
	. ssmuse-sh $(ALL_SSM) ;\
	s.compile -src $< -optc =$(CFLAGS) -libpath $(DESCRIP_PATH) -includes $(DESCRIP_PATH)

OBJECTS = unit_testing.o c_ut_report.o

UNIT_TEST_F: $(OBJECTS) UNIT_TEST_F.ftn90 $(DESCRIP_PATH)/libdescrip_debug.a
	. ssmuse-sh $(ALL_SSM) ;\
	s.compile $(OPENMP) -optf =$(FFLAGS) -includes $(DESCRIP_PATH) -src UNIT_TEST_F.ftn90 -o UNIT_TEST_F -libpath $(DESCRIP_PATH) -librmn -libappl descrip_debug -obj $(OBJECTS)

UNIT_TEST_C: $(OBJECTS) UNIT_TEST_C.c $(DESCRIP_PATH)/libdescrip_debug.a
	. ssmuse-sh $(ALL_SSM) ;\
	s.compile $(OPENMP) -optc =$(CFLAGS) -includes $(DESCRIP_PATH) -src UNIT_TEST_C.c -o UNIT_TEST_C -libpath $(DESCRIP_PATH) -librmn -libappl descrip_debug -bidon c -main UNIT_TEST_C -obj $(OBJECTS)

$(DESCRIP_PATH)/libdescrip_debug.a: 
	cd $(DESCRIP_PATH) && gmake DEBUG=1

clean:
	rm -f *.f90 *.o *.mod
