
#ifeq ($(BASE_ARCH),$(EC_ARCH))
#   $(info ERROR: please setup the compilation environment by typing the folowing:)
#   $(info . ../src/setup.dot or . ../src/setup_gpsc.dot)
#   $(error )
#endif

DESCRIP_PATH = ../src

%.o: %.F90
	gfortran -c $(MY_FFLAGS) -L$(DESCRIP_PATH) -I$(DESCRIP_PATH) $<

%.o: %.c
	gcc -c  $(MY_CFLAGS) -libpath $(DESCRIP_PATH) -I$(DESCRIP_PATH) $<

OBJECTS = unit_testing.o c_ut_report.o

UNIT_TEST_F: $(OBJECTS) UNIT_TEST_F.F90 $(DESCRIP_PATH)/libdescrip.a
	gfortran $(FFLAGS) $(OBJECTS) -o UNIT_TEST_F -I$(DESCRIP_PATH) -L$(DESCRIP_PATH) -lrmn -ldescrip UNIT_TEST_F.F90 

UNIT_TEST_C: $(OBJECTS) UNIT_TEST_C.c $(DESCRIP_PATH)/libdescrip.a
	s.compile $(OPENMP) -optc "=$(MY_CFLAGS)" -includes $(DESCRIP_PATH) -src UNIT_TEST_C.c -o UNIT_TEST_C -bidon c -main UNIT_TEST_C -obj $(OBJECTS) -libpath $(DESCRIP_PATH) -librmn -libappl descrip

$(DESCRIP_PATH)/libdescrip.a: $(DESCRIP_PATH)/*.c $(DESCRIP_PATH)/*.F90 $(DESCRIP_PATH)/*.h $(DESCRIP_PATH)/*.hc
	cd ../src ;
	$(BH_MAKE);\

clean:
	rm -f *.f90 *.o *.mod
