ifeq ($(BASE_ARCH),$(EC_ARCH))
   $(info ERROR: please setup the compilation environment by typing the folowing:)
   $(info . ../lib/setup.dot or . ../lib/setup_gpsc.dot)
   $(error )
endif

DESCRIP_PATH = ../lib

# Override incorrect implicits
%.o : %.mod

# Define suffix rules
.SUFFIXES: .F90 .o
%.o: %.F90    
	s.f90 -c $(MY_FFLAGS) -libpath $(DESCRIP_PATH) -I$(DESCRIP_PATH) $<

OBJECTS = $(DESCRIP_PATH)/vgrid_descriptors.o $(DESCRIP_PATH)/vgrid_genab_5002.o $(DESCRIP_PATH)/vgrid_genab_1002_5001.o $(DESCRIP_PATH)/vgrid_genab_1001.o $(DESCRIP_PATH)/vgrid_genab_1004.o $(DESCRIP_PATH)/vgrid_genab_2001.o $(DESCRIP_PATH)/utils.o unit_testing.o UNIT_TEST.o

UNIT_TEST: $(OBJECTS)
	s.f90 $(OBJECTS) -o UNIT_TEST $(MY_FFLAGS) -lrmn -L$(DESCRIP_PATH) -I$(DESCRIP_PATH)

unit_testing.o: unit_testing.F90

$(DESCRIP_PATH)/vgrid_descriptors.o: $(DESCRIP_PATH)/vgrid_descriptors.F90
	(cd $(DESCRIP_PATH) && $(MAKE) vgrid_descriptors.o)

$(DESCRIP_PATH)/vgrid_genab_5002.o: $(DESCRIP_PATH)/vgrid_genab_5002.F90
	(cd $(DESCRIP_PATH) && $(MAKE) vgrid_genab_5002.o)

$(DESCRIP_PATH)/vgrid_genab_1002_5001.o: $(DESCRIP_PATH)/vgrid_genab_1002_5001.F90
	(cd $(DESCRIP_PATH) && $(MAKE) vgrid_genab_1002_5001.o)

$(DESCRIP_PATH)/vgrid_genab_1001.o: $(DESCRIP_PATH)/vgrid_genab_1001.F90
	(cd $(DESCRIP_PATH) && $(MAKE) vgrid_genab_1001.o)

$(DESCRIP_PATH)/vgrid_genab_1004.o: $(DESCRIP_PATH)/vgrid_genab_1004.F90
	(cd $(DESCRIP_PATH) && $(MAKE) vgrid_genab_1004.o)

$(DESCRIP_PATH)/utils.o: $(DESCRIP_PATH)/utils.F90
	(cd $(DESCRIP_PATH) && $(MAKE) utils.o)

clean:
	rm -f *.o *.mod
