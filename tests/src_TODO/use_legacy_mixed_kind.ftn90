program constructor

   ! Object : try to construct the descriptor but there are many different vertical structures
   !          in the link file, this should produce an error.

  use vGrid_Descriptors, only: vgrid_descriptor,vgd_new,VGD_ERROR
  use Unit_Testing, only: ut_report

  implicit none

  type(vgrid_descriptor) :: d
  integer :: fnom,fstouv,fstlnk,i
  integer :: stat,lu1=10,lu2=20
  integer, parameter :: nfiles=3
  integer, dimension(nfiles) :: iun
  character(len=500),dimension(nfiles) :: files

  logical :: OK=.false.
  iun=0
  files(1)="data/dm_1001_from_model_run"
  files(2)="data/dm_1002_from_model_run"
  files(3)="data/dm_5001_from_model_run"
  !files(4)="data/dm_5002_from_model_run"

  do i=1,nfiles
     stat=fnom(iun(i),files(i),"RND",0)
     if(stat.lt.0)then
        print*,'ERROR with fnom on ',trim(files(i))
        call abort
     endif
     stat=fstouv(iun(i),"RND")
     if(stat.lt.0)then
        print*,'Error with fstouv on ',trim(files(i))
        call abort
     endif
  enddo

  stat=fstlnk(iun,nfiles)

  stat=vgd_new(d,iun(1))
  OK=stat.eq.VGD_ERROR

  call ut_report(OK,'Grid_Descriptors::vgd_vintage (5001)')

end program constructor
